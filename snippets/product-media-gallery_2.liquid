{% comment %}
  Swiper-based product media gallery for Dawn
{% endcomment %}

{% style %}
  .product--thumbnail .product__media-item.swiper-slide :not(.swiper-slide-active),
  .product--thumbnail_slider .product__media-item.swiper-slide :not(.swiper-slide-active){
    display: block;
  }
{% endstyle %}

{%- liquid
  assign media_count = product.media.size
  assign media_width = 0.55

  if section.settings.media_size == 'large'
    assign media_width = 0.65
  elsif section.settings.media_size == 'small'
    assign media_width = 0.45
  endif
-%}

<media-gallery
  id="MediaGallery-{{ section.id }}"
  role="region"
  aria-label="{{ 'products.product.media.gallery_viewer' | t }}"
>
  {{ media_count }}
  <!-- MAIN SWIPER -->
  <div class="swiper product-media-swiper" id="ProductMediaSwiper-{{ section.id }}">
    <div class="swiper-wrapper">

      {%- for media in product.media -%}
        <div
          class="swiper-slide product__media-item"
          data-media-id="{{ section.id }}-{{ media.id }}"
        >
          {{ media.preview_image | image_url: width: 200 | image_tag }}
        </div>
      {%- endfor -%}

    </div>

    <!-- Arrows -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>

    <!-- Pagination -->
    <div class="swiper-pagination"></div>
  </div>

  <!-- THUMBNAILS -->
  {% if media_count > 1 %}
    <div class="swiper product-media-thumbs" id="ProductMediaThumbs-{{ section.id }}">
      <div class="swiper-wrapper">

        {%- for media in product.media -%}
          <div class="swiper-slide product__media-thumb">
            {{
              media.preview_image
              | image_url: width: 200
              | image_tag:
                loading: 'lazy',
                alt: media.alt
            }}
          </div>
        {%- endfor -%}

      </div>
    </div>
  {% endif %}

</media-gallery>

<style>
/* --- Swiper Dawn tweaks --- */
.product-media-swiper {
  width: 100%;
}

.product-media-thumbs {
  margin-top: 1rem;
}

.product-media-thumbs .swiper-slide {
  cursor: pointer;
  opacity: 0.5;
}

.product-media-thumbs .swiper-slide-thumb-active {
  opacity: 1;
}

.swiper-button-prev,
.swiper-button-next {
  color: currentColor;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const thumbs = new Swiper('#ProductMediaThumbs-{{ section.id }}', {
    spaceBetween: 10,
    slidesPerView: 11,
    freeMode: true,
    watchSlidesProgress: true,
    breakpoints: {
      0: { slidesPerView: 4 },
      750: { slidesPerView: 5 }
    }
  });
  
  new Swiper('#ProductMediaSwiper-{{ section.id }}', {
    spaceBetween: 10,
    slidesPerView: 2.5,
    loop: false,
    navigation: {
      nextEl: '#MediaGallery-{{ section.id }} .swiper-button-next',
      prevEl: '#MediaGallery-{{ section.id }} .swiper-button-prev',
    },
    pagination: {
      el: '#MediaGallery-{{ section.id }} .swiper-pagination',
      clickable: true,
    },
    thumbs: {
      swiper: thumbs
    }
  });

});
</script>
